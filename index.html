<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electricity Usage Monitoring - AVL Tree</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .description {
            max-width: 800px;
            margin: 0 auto 20px;
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        
        .app-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .controls {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        
        .visualization {
            flex: 2;
            min-width: 500px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            min-height: 500px;
            position: relative;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        #tree-container {
            width: 100%;
            height: 450px;
            overflow: auto;
            position: relative;
        }
        
        .node {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #3498db;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            z-index: 2;
        }
        
        .node:hover {
            transform: scale(1.1);
            background: #2980b9;
        }
        
        .node-value {
            font-size: 14px;
        }
        
        .node-id {
            font-size: 10px;
            margin-top: 2px;
        }
        
        .line {
            position: absolute;
            height: 2px;
            background: white;
            transform-origin: 0 0;
            z-index: 1;
        }
        
        .stats {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .stats h3 {
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 5px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .highlight {
            color: #FFD700;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .controls, .visualization {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Electricity Usage Monitoring</h1>
            <p class="description">
                This visualization demonstrates an AVL tree data structure for monitoring electricity usage.
                Each node represents a household with its electricity consumption (kWh). The AVL tree automatically
                balances itself to maintain optimal performance for search operations.
            </p>
        </header>
        
        <div class="app-container">
            <div class="controls">
                <h2>Add Usage Data</h2>
                <div class="form-group">
                    <label for="household-id">Household ID:</label>
                    <input type="text" id="household-id" placeholder="e.g., H1001">
                </div>
                <div class="form-group">
                    <label for="usage">Electricity Usage (kWh):</label>
                    <input type="number" id="usage" placeholder="e.g., 350" min="1" max="1000">
                </div>
                <button id="add-btn">Add to Monitoring System</button>
                
                <div class="stats">
                    <h3>Statistics</h3>
                    <div class="stat-item">
                        <span>Total Households:</span>
                        <span id="total-households" class="highlight">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Tree Height:</span>
                        <span id="tree-height" class="highlight">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Total Usage:</span>
                        <span id="total-usage" class="highlight">0 kWh</span>
                    </div>
                    <div class="stat-item">
                        <span>Average Usage:</span>
                        <span id="avg-usage" class="highlight">0 kWh</span>
                    </div>
                </div>
            </div>
            
            <div class="visualization">
                <h2>AVL Tree Visualization</h2>
                <div id="tree-container">
                    <!-- Tree will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // AVL Tree Node Class
        class AVLNode {
            constructor(id, usage) {
                this.id = id;
                this.usage = usage;
                this.height = 1;
                this.left = null;
                this.right = null;
            }
        }

        // AVL Tree Class
        class AVLTree {
            constructor() {
                this.root = null;
                this.totalUsage = 0;
                this.householdCount = 0;
            }

            // Get height of node
            getHeight(node) {
                return node ? node.height : 0;
            }

            // Get balance factor of node
            getBalance(node) {
                return node ? this.getHeight(node.left) - this.getHeight(node.right) : 0;
            }

            // Right rotate
            rightRotate(y) {
                const x = y.left;
                const T2 = x.right;

                x.right = y;
                y.left = T2;

                y.height = Math.max(this.getHeight(y.left), this.getHeight(y.right)) + 1;
                x.height = Math.max(this.getHeight(x.left), this.getHeight(x.right)) + 1;

                return x;
            }

            // Left rotate
            leftRotate(x) {
                const y = x.right;
                const T2 = y.left;

                y.left = x;
                x.right = T2;

                x.height = Math.max(this.getHeight(x.left), this.getHeight(x.right)) + 1;
                y.height = Math.max(this.getHeight(y.left), this.getHeight(y.right)) + 1;

                return y;
            }

            // Insert a node
            insert(node, id, usage) {
                if (!node) {
                    this.householdCount++;
                    this.totalUsage += usage;
                    return new AVLNode(id, usage);
                }

                if (usage < node.usage) {
                    node.left = this.insert(node.left, id, usage);
                } else if (usage > node.usage) {
                    node.right = this.insert(node.right, id, usage);
                } else {
                    // Equal usage values not allowed in this implementation
                    return node;
                }

                // Update height
                node.height = 1 + Math.max(this.getHeight(node.left), this.getHeight(node.right));

                // Get balance factor
                const balance = this.getBalance(node);

                // Left Left Case
                if (balance > 1 && usage < node.left.usage) {
                    return this.rightRotate(node);
                }

                // Right Right Case
                if (balance < -1 && usage > node.right.usage) {
                    return this.leftRotate(node);
                }

                // Left Right Case
                if (balance > 1 && usage > node.left.usage) {
                    node.left = this.leftRotate(node.left);
                    return this.rightRotate(node);
                }

                // Right Left Case
                if (balance < -1 && usage < node.right.usage) {
                    node.right = this.rightRotate(node.right);
                    return this.leftRotate(node);
                }

                return node;
            }

            // Public insert method
            addHousehold(id, usage) {
                this.root = this.insert(this.root, id, usage);
            }

            // Get tree height
            getTreeHeight() {
                return this.getHeight(this.root);
            }

            // In-order traversal to get all nodes
            inOrderTraversal(node, result = []) {
                if (node) {
                    this.inOrderTraversal(node.left, result);
                    result.push(node);
                    this.inOrderTraversal(node.right, result);
                }
                return result;
            }

            // Get all nodes
            getAllNodes() {
                return this.inOrderTraversal(this.root);
            }
        }

        // Visualization and UI logic
        document.addEventListener('DOMContentLoaded', function() {
            const tree = new AVLTree();
            const treeContainer = document.getElementById('tree-container');
            const addBtn = document.getElementById('add-btn');
            const householdIdInput = document.getElementById('household-id');
            const usageInput = document.getElementById('usage');
            const totalHouseholdsSpan = document.getElementById('total-households');
            const treeHeightSpan = document.getElementById('tree-height');
            const totalUsageSpan = document.getElementById('total-usage');
            const avgUsageSpan = document.getElementById('avg-usage');

            // Add sample data
            const sampleData = [
                { id: 'H1001', usage: 350 },
                { id: 'H1002', usage: 420 },
                { id: 'H1003', usage: 290 },
                { id: 'H1004', usage: 510 },
                { id: 'H1005', usage: 380 }
            ];

            sampleData.forEach(data => {
                tree.addHousehold(data.id, data.usage);
            });

            // Render the tree
            renderTree();

            // Update statistics
            updateStats();

            // Add button event listener
            addBtn.addEventListener('click', function() {
                const id = householdIdInput.value.trim();
                const usage = parseInt(usageInput.value);

                if (!id) {
                    alert('Please enter a household ID');
                    return;
                }

                if (isNaN(usage) || usage < 1 || usage > 1000) {
                    alert('Please enter a valid usage between 1 and 1000 kWh');
                    return;
                }

                tree.addHousehold(id, usage);
                renderTree();
                updateStats();

                // Clear inputs
                householdIdInput.value = '';
                usageInput.value = '';
            });

            // Render the tree
            function renderTree() {
                treeContainer.innerHTML = '';
                
                if (!tree.root) return;

                const nodes = tree.getAllNodes();
                const treeHeight = tree.getTreeHeight();
                const containerWidth = treeContainer.clientWidth;
                const containerHeight = treeContainer.clientHeight;
                
                // Calculate positions for each node
                const positions = calculateNodePositions(tree.root, containerWidth, containerHeight);
                
                // Draw lines first (so they appear behind nodes)
                drawLines(positions);
                
                // Draw nodes
                drawNodes(positions);
            }

            // Calculate node positions for visualization
            function calculateNodePositions(root, width, height) {
                const positions = new Map();
                const treeHeight = tree.getTreeHeight();
                const levelHeight = height / (treeHeight + 1);
                
                function calculate(node, level, position, min, max) {
                    if (!node) return;
                    
                    const x = (min + max) / 2;
                    const y = level * levelHeight + 50;
                    
                    positions.set(node, { x, y, id: node.id, usage: node.usage });
                    
                    calculate(node.left, level + 1, position * 2, min, x);
                    calculate(node.right, level + 1, position * 2 + 1, x, max);
                }
                
                calculate(root, 0, 0, 0, width);
                return positions;
            }

            // Draw lines between nodes
            function drawLines(positions) {
                positions.forEach((position, node) => {
                    if (node.left && positions.has(node.left)) {
                        const leftPos = positions.get(node.left);
                        drawLine(position.x, position.y, leftPos.x, leftPos.y);
                    }
                    
                    if (node.right && positions.has(node.right)) {
                        const rightPos = positions.get(node.right);
                        drawLine(position.x, position.y, rightPos.x, rightPos.y);
                    }
                });
            }

            // Draw a line between two points
            function drawLine(x1, y1, x2, y2) {
                const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
                const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                
                const line = document.createElement('div');
                line.className = 'line';
                line.style.width = `${length}px`;
                line.style.left = `${x1}px`;
                line.style.top = `${y1}px`;
                line.style.transform = `rotate(${angle}deg)`;
                
                treeContainer.appendChild(line);
            }

            // Draw nodes
            function drawNodes(positions) {
                positions.forEach((position, node) => {
                    const nodeElement = document.createElement('div');
                    nodeElement.className = 'node';
                    nodeElement.style.left = `${position.x - 30}px`;
                    nodeElement.style.top = `${position.y - 30}px`;
                    
                    nodeElement.innerHTML = `
                        <div class="node-value">${position.usage}kWh</div>
                        <div class="node-id">${position.id}</div>
                    `;
                    
                    treeContainer.appendChild(nodeElement);
                });
            }

            // Update statistics
            function updateStats() {
                totalHouseholdsSpan.textContent = tree.householdCount;
                treeHeightSpan.textContent = tree.getTreeHeight();
                totalUsageSpan.textContent = `${tree.totalUsage} kWh`;
                avgUsageSpan.textContent = tree.householdCount > 0 
                    ? `${Math.round(tree.totalUsage / tree.householdCount)} kWh` 
                    : '0 kWh';
            }
        });
    </script>
</body>
</html>
